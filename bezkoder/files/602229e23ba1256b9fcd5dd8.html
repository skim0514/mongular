Namespace("jp.mixi.register.widget.postuieventlog").use("jp.mixi.service.analysis postUIEventLogToGA").define(function(ns){"use strict";ns.provide({registerElement:function(element,dataset){$j(element).on("click",function(evt){evt.preventDefault();var trackerName="global";ns.postUIEventLogToGA(trackerName,{eventCategory:dataset.eventCategory,eventLabel:dataset.eventLabel});window.open(element.href,"_blank")})}})});Namespace("jp.mixi.register.touch.widget.sexselector").define(function(ns){"use strict";var BUTTON_ACTIVE_CLASS="REGISTER_form__button--active";ns.provide({registerElement:function(element,dataset){var $sexButton=$j(element).find(dataset.sexButtonSelector);var $sexHidden=$j(element).find(dataset.sexHiddenSelector);$sexButton.on("click",function(){$sexButton.removeClass(BUTTON_ACTIVE_CLASS);$j(this).addClass(BUTTON_ACTIVE_CLASS);$sexHidden.val($j(this).data("value"))})}})});Namespace("jp.mixi.touch.register.profile.password.visibility").use("brook.dom.compat dataset").define(function(ns){"use strict";var initialize=function(element,dataset){var password=$j(element).find(dataset.passwordFormSelector).first();var checkbox=$j(element).find(dataset.checkboxVisibilitySelector).first();checkbox.on("click",function(evt){if(checkbox.prop("checked")){password.attr("type","text")}else{password.attr("type","password")}})};ns.provide({registerElement:initialize})});Namespace("jp.mixi.touch.register.profile.validator.formvalidator").use("jp.co.mixi.lang.class defineClass").use("jp.co.mixi.lang.string countByteLength").define(function(ns){"use strict";var _Validator=ns.defineClass({TEXT_INPUT_VALIDATION_INTERVAL:500,initialize:function(target){this.target=target},getValidateTargetString:function(){if(this.target instanceof Function)return this.target();if(this.target.val)return this.target.val();if(this.target.text)return this.target.text()},setOnInvalid:function(onInvalidCallback){this.onInvalid=onInvalidCallback;return this},setOnValid:function(onValidCallback){this.onValid=onValidCallback;return this},validate:function(validations){var invalids=[],self=this;_.each(validations,function(validation){if(!validation.evaluation(self.getValidateTargetString())){invalids.push(validation)}});if(invalids.length>0){if(this.onInvalid)this.onInvalid(invalids)}else{if(this.onValid)this.onValid(validations)}},observeTextInputWithValidations:function(){var validations=_.toArray(arguments);var timerId;var self=this;if(this.target instanceof Function)return this;this.target.on("focus",function(evt){timerId=setInterval(function(){if(!timerId)return;self.validate(validations)},self.TEXT_INPUT_VALIDATION_INTERVAL)}).on("blur",function(evt){clearInterval(timerId);timerId=null});return this},observeBlurWithValidations:function(){var validations=_.toArray(arguments);var self=this;if(this.target instanceof Function)return this;this.target.on("blur",function(evt){self.validate(validations)});return this},observeChangeWithValidations:function(){var validations=_.toArray(arguments);var self=this;if(this.target instanceof Function)return this;this.target.on("change",function(evt){self.validate(validations)});return this}});var _isWhiteSpaceOnly=function(str){var validRegexSpaceOnly=/^[\s　]+$/;if(str.match(validRegexSpaceOnly))return true;return false};var _isHalfWidthKana=function(str){return!!str.match(/^[\uff61-\uffa0]+$/)};var _isHalfWidthAscii=function(str){return!!str.match(/^[\x20-\x7e]+$/)};var _isValidFullDate=function(str){if(str.split("/").length!==3)return false;var date=new Date(str);var remakeDateStr=date.getFullYear()+"/"+(date.getMonth()+1)+"/"+date.getDate();return remakeDateStr===str};var _isPositiveNumber=function(obj){var inputNumber;if(typeof obj==="string"){inputNumber=parseInt(obj,10)}else if(typeof obj==="number"){inputNumber=obj}else{return false}return inputNumber>0};ns.provide({isPositiveNumber:_isPositiveNumber,isWhiteSpaceOnly:_isWhiteSpaceOnly,isHalfWidthKana:_isHalfWidthKana,isHalfWidthAscii:_isHalfWidthAscii,isValidFullDate:_isValidFullDate,Validator:_Validator})});Namespace("jp.mixi.touch.register.profile.validator.model.email").use("brook promise").use("brook.model createModel").define(function(ns){"use strict";var model=ns.createModel({filledRequiredItems:ns.promise(),notFilledRequiredItems:ns.promise(),validateAll:ns.promise()});model.isValidEmail=false;model.sendAllValidationResult=function(){if(this.isValidEmail){this.notify("filledRequiredItems").run()}else{this.notify("notFilledRequiredItems").run()}};model.setIsValidEmail=function(isValidEmail){this.isValidEmail=isValidEmail;this.sendAllValidationResult()};ns.provide({emailFormModel:model})});Namespace("jp.mixi.touch.register.profile.validator.model.profileform").use("brook promise").use("brook.model createModel").use("brook.dom.compat dataset").define(function(ns){"use strict";var model=ns.createModel({filledRequiredItems:ns.promise(),notFilledRequiredItems:ns.promise(),validateAll:ns.promise()});model.isValidMap={nickName:false,sex:false,birthday:false,password:false};model.hasRequiredItems=function(){var self=this;return _.all(self.isValidMap,function(value){return value})};model.sendAllValidationResult=function(){if(this.hasRequiredItems()){this.notify("filledRequiredItems").run()}else{this.notify("notFilledRequiredItems").run()}};model.setIsValid=function(validName,isValid){this.isValidMap[validName]=isValid;this.sendAllValidationResult()};ns.provide({profileFormModel:model})});Namespace("jp.mixi.touch.register.profile.validator.model.telform").use("brook promise").use("brook.model createModel").use("brook.dom.compat dataset").define(function(ns){"use strict";var model=ns.createModel({filledRequiredItems:ns.promise(),notFilledRequiredItems:ns.promise(),validateAll:ns.promise()});model.isValidTel=false;model.sendAllValidationResult=function(){if(this.isValidTel){this.method("filledRequiredItems").send().run()}else{this.method("notFilledRequiredItems").send().run()}};model.setIsValidTel=function(isValidTel){this.isValidTel=isValidTel;this.sendAllValidationResult()};ns.provide({telFormModel:model})});Namespace("jp.mixi.touch.register.profile.validator.widget.address").use("brook.dom.compat dataset").use("jp.co.mixi.ui.template getTemplateByElementId").use("jp.mixi.touch.register.profile.validator.formvalidator Validator,isWhiteSpaceOnly,isPositiveNumber").use("jp.mixi.touch.register.profile.validator.model.profileform profileFormModel").use("brook.util through").define(function(ns){"use strict";var NOT_SELECTED="0";var MIN_BYTE_SIZE=0;var MAX_BYTE_SIZE=20;var notEmptyValidation={evaluation:function(str){return!_.isEmpty(str)},message:"都道府県を選択してください。"};var positiveIndexValidation={evaluation:function(str){return ns.isPositiveNumber(str)},message:"都道府県を選択してください。"};var createValidator=function($element,dataset){var $address=$element.find(dataset.addressFormSelector).first();var $alertArea=$element.find(dataset.alertAreaSelector).first();var alertItemTmpl=ns.getTemplateByElementId(dataset.alertItemTemplate);var validator=new ns.Validator($address);validator.setOnValid(function(validValidations){$alertArea.html("");ns.profileFormModel.setIsValid("address",true)}).setOnInvalid(function(invalidValidations){$alertArea.html("");_.each(invalidValidations,function(invalidValidation){var msg=invalidValidation.message||"";alertItemTmpl.param({message:msg});$alertArea.append($j(alertItemTmpl.output()))});ns.profileFormModel.setIsValid("address",false)});return validator};var recheckValue=function(validator){validator.validate([notEmptyValidation,positiveIndexValidation])};var initialize=function(element,dataset){var validator=createValidator($j(element),dataset).observeChangeWithValidations(notEmptyValidation).observeBlurWithValidations(positiveIndexValidation);ns.profileFormModel.method("validateAll").observe(ns.through(function(){validator.validate([notEmptyValidation,positiveIndexValidation])}));var address=$j(element).find(dataset.addressFormSelector).first();var validations=[notEmptyValidation,positiveIndexValidation];if(_.all(validations,function(validation){return validation.evaluation(address.val())})){ns.profileFormModel.setIsValid("address",true)}};ns.provide({registerElement:initialize})});Namespace("jp.mixi.touch.register.profile.validator.widget.birthday").use("brook.dom.compat dataset").use("brook.util through").use("jp.co.mixi.ui.template getTemplateByElementId").use("jp.mixi.touch.register.profile.validator.formvalidator isValidFullDate,isPositiveNumber,Validator").use("jp.mixi.touch.register.profile.validator.model.profileform profileFormModel").define(function(ns){var NOT_SELECTED="0";var isOver15YearsOld=function(dateStr){var date=new Date(dateStr);if(date.toString()==="Invalid Date")return true;var today=new Date;var maxDayLimit=new Date(today.getFullYear()-15+"/"+(today.getMonth()+1)+"/"+today.getDate());return date.getTime()<=maxDayLimit.getTime()};var validationEmpty={evaluation:function(str){return!_.isEmpty(str)},message:"誕生日を選択してください。"};var validationOver15YearsOld={evaluation:isOver15YearsOld,message:"15歳未満は登録できません。"};var validationDateFormat={evaluation:ns.isValidFullDate,message:"正しい日付を選択してください。"};var createValidator=function($element,dataset){var yearObject=$element.find(dataset.yearFormSelector).first();var monthObject=$element.find(dataset.monthFormSelector).first();var dayObject=$element.find(dataset.dayFormSelector).first();var alertArea=$element.find(dataset.alertAreaSelector).first();var alertItemTmpl=ns.getTemplateByElementId(dataset.alertItemTemplate);var validator=new ns.Validator(function(){var str=yearObject.val()+"/"+monthObject.val()+"/"+dayObject.val();return str});validator.setOnValid(function(validations){alertArea.html("");ns.profileFormModel.setIsValid("birthday",true)}).setOnInvalid(function(invalidValidations){alertArea.html("");_.each(invalidValidations,function(invalidValidation){var msg=invalidValidation.message||"";alertItemTmpl.param({message:msg});alertArea.append(alertItemTmpl.output())});ns.profileFormModel.setIsValid("birthday",false)});var injectValidationEvent=function(dateObject){dateObject.on("change",function(evt){if(ns.isPositiveNumber(yearObject.val())&&ns.isPositiveNumber(monthObject.val())&&ns.isPositiveNumber(dayObject.val())){validator.validate([validationEmpty,validationDateFormat,validationOver15YearsOld])}})};validator.observe=function(){injectValidationEvent(yearObject);injectValidationEvent(monthObject);injectValidationEvent(dayObject)};return validator};var initialize=function(element,dataset){var $element=$j(element);var validator=createValidator($element,dataset);validator.observe();ns.profileFormModel.method("validateAll").observe(ns.through(function(){validator.validate([validationEmpty,validationDateFormat,validationOver15YearsOld])}));var year=$element.find(dataset.yearFormSelector).first();var month=$element.find(dataset.monthFormSelector).first();var day=$element.find(dataset.dayFormSelector).first();if(year.val()!==NOT_SELECTED&&month.val()!==NOT_SELECTED&&day.val()!==NOT_SELECTED){var birthday=year.val()+"/"+month.val()+"/"+day.val();var validations=[validationEmpty,validationDateFormat,validationOver15YearsOld];if(_.all(validations,function(validation){return validation.evaluation(birthday)})){ns.profileFormModel.setIsValid("birthday",true)}}};ns.provide({registerElement:initialize,_validateOver15YearsOld:isOver15YearsOld})});Namespace("jp.mixi.touch.register.profile.validator.widget.email").use("brook.util through").use("brook.dom.compat dataset").use("jp.co.mixi.ui.template getTemplateByElementId").use("jp.mixi.touch.register.profile.validator.formvalidator Validator").use("jp.mixi.touch.register.profile.validator.model.email emailFormModel").define(function(ns){"use strict";var MAX_LENGTH=255;var validRegExpAll=/^[\w!\$%&\'~=\^*+,.?_\/\-]+\@[0-9a-zA-Z\.\-]+$/;var validRegExpLocalPart=/^[\w!\$%&\'~=\^*+,.?_\/\-]+$/;var validRegExpDomain=/^[0-9a-zA-Z\.\-]+$/;var formatValidation={evaluation:function(str){if(!str)return true;if(!str.match(validRegExpAll))return false;if(!str.match(/\.([a-zA-Z]{2,5})$/))return false;return true},message:"正しい形式のメールアドレスを入力してください。"};var emptyValidation={evaluation:function(str){return!_.isEmpty(str)},message:"メールアドレスを入力してください。"};var localPartCharacterValidation={evaluation:function(str){if(!str)return true;var localPart=_splitByFirstAtMark(str)[0];if(localPart&&!localPart.match(validRegExpLocalPart))return false;return true},message:"メールアドレスに使用できない文字が含まれています。"};var domainCharacterValidation={evaluation:function(str){if(!str)return true;var domain=_splitByFirstAtMark(str)[1];if(domain&&!domain.match(validRegExpDomain))return false;return true},message:"@のあとに使用できない文字が含まれています。"};var _splitByFirstAtMark=function(str){var index=str.indexOf("@");if(index<0)index=str.length;return[str.slice(0,index),str.slice(index+1)]};var lengthValidation={evaluation:function(str){return str.length<=MAX_LENGTH},message:"メールアドレスは"+MAX_LENGTH+"文字以内で入力してください。"};var createValidator=function($email,$alertArea,dataset){var alertItemTmpl=ns.getTemplateByElementId(dataset.alertItemTemplate);var validator=new ns.Validator($email);validator.setOnValid(function(validValidations){$alertArea.html("");ns.emailFormModel.setIsValidEmail(true)}).setOnInvalid(function(invalidValidations){$alertArea.html("");_.each(invalidValidations,function(invalidValidation){var msg=invalidValidation.message||"";alertItemTmpl.param({message:msg});$alertArea.append($j(alertItemTmpl.output()));ns.emailFormModel.setIsValidEmail(false)})});return validator};ns.provide({_emailFormatValidation:formatValidation.evaluation,_localPartCharacterValidation:localPartCharacterValidation.evaluation,_domainCharacterValidation:domainCharacterValidation.evaluation,registerElement:function(element,dataset){var $element=$j(element);var $email=$element.find(dataset.emailFormSelector);var $alertArea=$element.find(dataset.alertAreaSelector);var validator=createValidator($email,$alertArea,dataset).observeTextInputWithValidations(localPartCharacterValidation,domainCharacterValidation,lengthValidation).observeBlurWithValidations(formatValidation,lengthValidation,emptyValidation);ns.emailFormModel.method("validateAll").observe(ns.through(function(){validator.validate([formatValidation,lengthValidation,emptyValidation])}));var str=$email.val();if(formatValidation.evaluation(str)&&lengthValidation.evaluation(str)&&emptyValidation.evaluation(str)){ns.emailFormModel.setIsValidEmail(true)}}})});Namespace("jp.mixi.touch.register.profile.validator.widget.emailform").use("brook.util through").use("brook.dom.compat dataset").use("jp.co.mixi.lang.class defineClass").use("jp.co.mixi.ui.template getTemplateByElementId").use("jp.mixi.touch.register.profile.validator.model.email emailFormModel").use("jp.mixi.touch.register.profile.validator.formvalidator Validator").define(function(ns){"use strict";var submitButtonSelector=".JS_submitButton";var SubmitButton=ns.defineClass({initialize:function($form,fromId){this.$el=$form.find(submitButtonSelector);this.$form=$form;this.fromId=fromId;this.canSubmit=false;return this},_submitHandler:function(evt){if(!this.canSubmit){evt.preventDefault();ns.emailFormModel.notify("validateAll").run();window.alert("メールアドレスを正しく入力してください。");return}},eventify:function(){var self=this;this.$form.on("submit",function(evt){self._submitHandler(evt)});this.$el.on("click",function(evt){self._submitHandler(evt)});return this},observeModel:function(){var self=this;ns.emailFormModel.method("filledRequiredItems").observe(ns.through(function(){self.canSubmit=true}));ns.emailFormModel.method("notFilledRequiredItems").observe(ns.through(function(){self.canSubmit=false}));return this}});ns.provide({registerElement:function(element,dataset){var $form=$j(element);new SubmitButton($form,dataset.fromId).eventify().observeModel()}})});Namespace("jp.mixi.touch.register.profile.validator.widget.nickname").use("brook.dom.compat dataset").use("jp.co.mixi.ui.template getTemplateByElementId").use("jp.mixi.touch.register.profile.validator.formvalidator isWhiteSpaceOnly,Validator").use("jp.mixi.touch.register.profile.validator.model.profileform profileFormModel").use("jp.co.mixi.lang.string countByteLength").use("brook.util through").define(function(ns){"use strict";var nicknameObject,alertAreaObject,alertItemTemplate;var addInvalidMessage=function(message){if(!alertAreaObject||!alertItemTemplate)return;alertItemTemplate.param({message:message});var item=$j(alertItemTemplate.output());alertAreaObject.append(item)};var clearInvalidMessage=function(){alertAreaObject.children().remove()};var emptyValidation={evaluation:function(str){return!_.isEmpty(str)},message:"ニックネームを入力してください。"};var maxLengthValidation={evaluation:function(str){return ns.countByteLength(str)<=20},message:"全角10文字（半角20文字）以内で入力してください。"};var notWhiteSpaceOnlyValidation={evaluation:function(str){return!ns.isWhiteSpaceOnly(str)},message:"空白文字のみのニックネームは使用できません。"};var createValidator=function(element,dataset){nicknameObject=element.find(dataset.formNickname).first();alertAreaObject=element.find(dataset.alertArea).first();alertItemTemplate=ns.getTemplateByElementId(dataset.alertItemTemplate);var validator=new ns.Validator(nicknameObject);validator.setOnInvalid(function(validations){clearInvalidMessage();for(var i=0;i<validations.length;i++){addInvalidMessage(validations[i].message)}ns.profileFormModel.setIsValid("nickName",false)});validator.setOnValid(function(validations){alertAreaObject.text("");ns.profileFormModel.setIsValid("nickName",true)});return validator};var initialize=function(element,dataset){var validator=createValidator($j(element),dataset).observeTextInputWithValidations(maxLengthValidation).observeBlurWithValidations(notWhiteSpaceOnlyValidation,emptyValidation,maxLengthValidation);ns.profileFormModel.method("validateAll").observe(ns.through(function(){validator.validate([emptyValidation,maxLengthValidation,notWhiteSpaceOnlyValidation])}));var nickname=$j(element).find(dataset.formNickname).first();var validations=[emptyValidation,maxLengthValidation,notWhiteSpaceOnlyValidation];if(_.all(validations,function(validation){return validation.evaluation(nickname.val())})){ns.profileFormModel.setIsValid("nickName",true)}};ns.provide({registerElement:initialize})});Namespace("jp.mixi.touch.register.profile.validator.widget.password").use("brook.dom.compat dataset").use("jp.co.mixi.ui.template getTemplateByElementId").use("jp.mixi.touch.register.profile.validator.formvalidator Validator").use("jp.mixi.touch.register.profile.validator.model.profileform profileFormModel").use("brook.util through").define(function(ns){"use strict";var MIN_LENGTH=6;var MAX_LENGTH=64;var emptyValidation={evaluation:function(str){return!_.isEmpty(str)},message:"パスワードを入力してください。"};var lengthMessage="パスワードは半角英数字で"+MIN_LENGTH+"文字以上"+MAX_LENGTH+"文字以内で入力してください。";var maxLengthValidation={evaluation:function(str){return str.length>MAX_LENGTH?false:true},message:lengthMessage};var minLengthValidation={evaluation:function(str){if(!str)return true;return str.length<MIN_LENGTH?false:true},message:lengthMessage};var notOnlyNumberValidation={evaluation:function(str){if(!str)return true;return!str.match(/^\d+$/)},message:"数字のみのパスワードは設定できません。"};var characterValidation={evaluation:function(str){if(!str)return true;return str.match(/^[\w!\"#\$%&\'()~\-=\^\\@`\[\]\{\}:*;+<>,.?_\/]+$/)?true:false},message:"パスワードに使用できるのは半角英数字と記号のみです。"};var createValidator=function($element,dataset){var $password=$element.find(dataset.passwordFormSelector);var $alertArea=$element.find(dataset.alertAreaSelector);var alertItemTmpl=ns.getTemplateByElementId(dataset.alertItemTemplate);var validator=new ns.Validator($password);validator.setOnValid(function(validValidations){$alertArea.html("");ns.profileFormModel.setIsValid("password",true)}).setOnInvalid(function(invalidValidations){$alertArea.html("");_.each(invalidValidations,function(invalidValidation){var msg=invalidValidation.message||"";alertItemTmpl.param({message:msg});$alertArea.append($j(alertItemTmpl.output()))});ns.profileFormModel.setIsValid("password",false)});return validator};var initialize=function(element,dataset){var validator=createValidator($j(element),dataset).observeTextInputWithValidations(characterValidation,maxLengthValidation,notOnlyNumberValidation).observeBlurWithValidations(characterValidation,minLengthValidation,maxLengthValidation,emptyValidation,notOnlyNumberValidation);ns.profileFormModel.method("validateAll").observe(ns.through(function(){validator.validate([emptyValidation,maxLengthValidation,minLengthValidation,characterValidation,notOnlyNumberValidation])}));var password=$j(element).find(dataset.passwordFormSelector);var validations=[emptyValidation,maxLengthValidation,minLengthValidation,characterValidation,notOnlyNumberValidation];if(_.all(validations,function(validation){return validation.evaluation(password.val())})){ns.profileFormModel.setIsValid("password",true)}};ns.provide({_passwordCharacterValidation:characterValidation.evaluation,_passwordNotOnlyNumberValidation:notOnlyNumberValidation.evaluation,registerElement:initialize})});Namespace("jp.mixi.touch.register.profile.validator.widget.profileform").use("brook.util through").use("brook.dom.compat dataset").use("jp.co.mixi.ui.template getTemplateByElementId").use("jp.mixi.touch.register.profile.validator.model.profileform profileFormModel").use("jp.mixi.touch.register.profile.validator.formvalidator Validator").use("jp.co.mixi.lang.class defineClass").define(function(ns){"use strict";var SubmitButton=ns.defineClass({button:"",form:"",realname:"",canSubmit:false,isSubmitted:false,initialize:function(button,form,realname){this.button=button;this.form=form;this.realname=realname},_submitHandler:function(evt){ns.profileFormModel.notify("validateAll").run();if(!this.canSubmit){evt.preventDefault();window.alert("すべての項目を正しく入力してください。");return}if(this.isSubmitted)return;this.isSubmitted=true;if(!this.realname.val()){evt.preventDefault();this.realname.val(" ");this.form.submit()}},eventify:function(){var self=this;this.form.on("submit",function(evt){self._submitHandler(evt)});this.button.on("click",function(evt){self._submitHandler(evt)});return this},observeModel:function(){var self=this;ns.profileFormModel.method("filledRequiredItems").observe(ns.through(function(){self.canSubmit=true}));ns.profileFormModel.method("notFilledRequiredItems").observe(ns.through(function(){self.canSubmit=false}));return this}});var initialize=function(element,dataset){var form=$j(element);var realname=form.find(dataset.realnameFormSelector);var submitButton=new SubmitButton(form.find(dataset.submitButtonSelector).first(),form,realname);submitButton.eventify().observeModel()};ns.provide({registerElement:initialize})});Namespace("jp.mixi.touch.register.profile.validator.widget.sex").use("brook.dom.compat dataset").use("jp.co.mixi.ui.template getTemplateByElementId").use("jp.mixi.touch.register.profile.validator.formvalidator Validator,isWhiteSpaceOnly").use("jp.mixi.touch.register.profile.validator.model.profileform profileFormModel").use("jp.co.mixi.lang.string countByteLength").use("brook promise").define(function(ns){"use strict";var selectedSexValidation={evaluation:function(str){if(!str)return false;return str==="m"||str=="f"},message:"性別を選択してください。"};var MODEL_PARAM_NAME="sex";var createValidator=function($element,dataset){var $sexHidden=$element.find(dataset.sexHiddenSelector);var $alertArea=$element.find(dataset.alertAreaSelector).first();var alertItemTmpl=ns.getTemplateByElementId(dataset.alertItemTemplate);var nameType=dataset.nameType;var validator=new ns.Validator(function(){return $sexHidden.val()});validator.setOnValid(function(validValidations){$alertArea.html("");ns.profileFormModel.setIsValid(MODEL_PARAM_NAME,true)}).setOnInvalid(function(invalidValidations){$alertArea.html("");_.each(invalidValidations,function(invalidValidation){var msg=invalidValidation.message||"";alertItemTmpl.param({message:msg});$alertArea.append($j(alertItemTmpl.output()));ns.profileFormModel.setIsValid(MODEL_PARAM_NAME,false)})});return validator};var initialize=function(element,dataset){var $element=$j(element);var validator=createValidator($element,dataset);ns.profileFormModel.method("validateAll").observe(ns.promise(function(){validator.validate([selectedSexValidation])}));var $sexHidden=$element.find(dataset.sexHiddenSelector);var sex=$sexHidden.val();$sexHidden.on("change",function(){validator.validate([selectedSexValidation])});var validations=[selectedSexValidation];if(_.all(validations,function(validation){return validation.evaluation(sex)})){ns.profileFormModel.setIsValid(MODEL_PARAM_NAME,true)}};ns.provide({registerElement:initialize,_selectedSexValidation:selectedSexValidation})});Namespace("jp.mixi.touch.register.profile.validator.widget.tel").use("brook.util through").use("brook.dom.compat dataset").use("jp.co.mixi.ui.template getTemplateByElementId").use("jp.mixi.touch.register.profile.validator.formvalidator Validator").use("jp.mixi.touch.register.profile.validator.model.telform telFormModel").define(function(ns){"use strict";var lengthValidationMessage="電話番号は11桁で入力してください。";var lengthMaxLimitValidation={evaluation:function(str){if(!str)return true;return str.length<=11},message:lengthValidationMessage};var lengthValidation={evaluation:function(str){if(!str)return true;return str.length===11},message:lengthValidationMessage};var emptyValidation={evaluation:function(str){return!_.isEmpty(str)},message:"電話番号を入力してください。"};var characterValidation={evaluation:function(str){if(!str)return true;if(str.match(/[^0-9０-９]/))return false;return true},message:"数字のみで入力してください。"};var firstThreeCharactersValidation={evaluation:function(str){if(str.length<3)return true;if(!str.match(/^[0０][789７８９][0０]/))return false;return true},message:"070, 080, 090 のいずれかで始まる番号を入力してください。"};var createValidator=function($tel,$alertArea,alertItemTmpl){var validator=new ns.Validator($tel);validator.setOnValid(function(validValidations){$alertArea.html("");ns.telFormModel.setIsValidTel(true)}).setOnInvalid(function(invalidValidations){$alertArea.html("");_.each(invalidValidations,function(invalidValidation){var msg=invalidValidation.message||"";alertItemTmpl.param({message:msg});$alertArea.append(alertItemTmpl.output());ns.telFormModel.setIsValidTel(false)})});return validator};ns.provide({_telLengthMaxLimitValidation:lengthMaxLimitValidation.evaluation,_telLengthValidation:lengthValidation.evaluation,_telCharacterValidation:characterValidation.evaluation,_telFirstThreeCharactersValidation:firstThreeCharactersValidation.evaluation,registerElement:function(element,dataset){var $element=$j(element);var $tel=$element.find(dataset.telInputSelector);var $alertArea=$element.find(dataset.alertAreaSelector);var alertItemTmpl=ns.getTemplateByElementId(dataset.alertItemTemplate);var validator=createValidator($tel,$alertArea,alertItemTmpl).observeTextInputWithValidations(characterValidation,firstThreeCharactersValidation,lengthMaxLimitValidation).observeBlurWithValidations(lengthValidation,emptyValidation,characterValidation,firstThreeCharactersValidation);ns.telFormModel.method("validateAll").observe(ns.through(function(){validator.validate([lengthValidation,characterValidation,firstThreeCharactersValidation,emptyValidation])}));var str=$tel.val();if(_.all([lengthValidation,characterValidation,firstThreeCharactersValidation,emptyValidation],function(validation){return validation.evaluation(str)})){ns.telFormModel.setIsValidTel(true)}}})});Namespace("jp.mixi.touch.register.profile.validator.widget.telform").use("brook.util through").use("brook.dom.compat dataset").use("jp.mixi.touch.register.profile.validator.model.telform telFormModel").use("jp.co.mixi.lang.class defineClass").define(function(ns){"use strict";var $form;var submitButtonSelector=".JS_submitButton";var SubmitButton=ns.defineClass({$el:"",fromId:"",targetSmsUrl:"",canSubmit:false,isSubmitted:false,initialize:function($element,fromId,targetSmsUrl){this.$el=$element;this.fromId=fromId;this.targetSmsUrl=targetSmsUrl;return this},_submitHandler:function(evt){if(!this.canSubmit){evt.preventDefault();ns.telFormModel.notify("validateAll").run();window.alert("すべての項目を正しく入力してください。");return}if(this.isSubmitted)return;evt.preventDefault();this.isSubmitted=true;$form.attr("action",this.targetSmsUrl).submit()},eventify:function(){var self=this;$form.on("submit",function(evt){self._submitHandler(evt)});this.$el.on("click",function(evt){self._submitHandler(evt)});return this},observeModel:function(){var self=this;ns.telFormModel.method("filledRequiredItems").observe(ns.through(function(){self.canSubmit=true}));ns.telFormModel.method("notFilledRequiredItems").observe(ns.through(function(){self.canSubmit=false}));return this}});ns.provide({registerElement:function(element,dataset){$form=$j(element);var submitButton=new SubmitButton($form.find(submitButtonSelector),dataset.fromId,dataset.targetSmsUrl);submitButton.eventify().observeModel();if(dataset.canEdit){var $modifyButton=$form.find(dataset.modifyButtonSelector);$modifyButton.on("click",function(evt){evt.preventDefault();location.href=dataset.editUrl})}}})});